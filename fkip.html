<!DOCTYPE html>
<html>
<head>
	<title>Proyek GIS</title>
	<style type="text/css">
		html, body {
			margin: 0px;
			padding: 0px;
		}
		#map {
			width: 100%;
			height: 550px;
		}
	</style>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
</head>
<body>
	<h1>Sistem Informasi Pesebaran Asal Mahasiswa Unila</h1>
	<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
		<a class="navbar-brand" href="project.html">Home</a>

		  <!-- Links -->
		  <ul class="navbar-nav">
		  	<li class="nav-item">
      			<a class="nav-link" href="top3.html">TOP 3</a>
    		</li>
		    <!-- Dropdown -->
		    <li class="nav-item dropdown">
		      <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
		        Fakultas
		      </a>
		      <div class="dropdown-menu">
		        <a class="dropdown-item" href="fmipa.html">FMIPA</a>
		        <a class="dropdown-item" href="fkip.html">FKIP</a>
		        <a class="dropdown-item" href="fisip.html">FISIP</a>
		        <a class="dropdown-item" href="fp.html">FP</a>
		        <a class="dropdown-item" href="ft.html">FT</a>
		        <a class="dropdown-item" href="fh.html">FH</a>
		        <a class="dropdown-item" href="fk.html">FK</a>
		        <a class="dropdown-item" href="feb.html">FEB</a>
		      </div>
		    </li>
		  </ul>
	</nav>

	<div id="map"></div><br>
	<button type="button" id="submit" style="padding: 10px 25px; background: #4CAF50; color: white; border: none; border-radius: 1px; margin-top: 30px;">Simpan</button>

	<!-- Inisial backend -->
	<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBCx0yZKvuXFS6QawkRgVvmSw_xL7eDS_4&callback=initMap"></script>

    <script type="text/javascript">
    	// Initialize Firebase
  		var config = {
		    apiKey: "AIzaSyDbARvy8PQdUMbMv1YlB1pldy7x7V3ihwM",
		    authDomain: "project-akhir-6e8e2.firebaseapp.com",
		    databaseURL: "https://project-akhir-6e8e2.firebaseio.com",
		    projectId: "project-akhir-6e8e2",
		    storageBucket: "project-akhir-6e8e2.appspot.com",
		    messagingSenderId: "406576065263"
		};
		firebase.initializeApp(config);
	  	var db              = firebase.database();
		var dataRef         = db.ref('fkip');
		
		var map 			= null;
		var newPolygon      = null;
		var arrayPolygon    = [];
		var coords          = [];
		var markers         = [];
    	var center = {lat: -4.9516568, lng: 105.1810978};
    	dataRef.on('value', updateInfo, showErr);

    	function initMap(){
	    	map=new google.maps.Map(document.getElementById('map'),{
	        	zoom:5,
	        	center:center,
	        	disableDefaultUI: true,
	        	draggable: false,
	        	maxZoom: 5,
	        	minZoom: 5,
	    	});

    		map.addListener('click', function (e) {
		        var latLng = e.latLng;
		        coords.push({lat: latLng.lat(), lng: latLng.lng()});
		        markers.push(createMarker({lat: latLng.lat(), lng: latLng.lng()}));
    		});
 	   	}
 	   	function createMarker(coord){
		    var marker = new google.maps.Marker(
		        {
		            position:coord,
		            map: map
		        }
		    );
		    return marker;
		}
		function createPolygon(coord){
		    var tempPoly=new google.maps.Polygon({
		        paths:coord,
		        strokeColor: '#FF0000',
		        strokeOpacity:0.8,
		        strokeWeight:2,
		        fillColor:'#FF0000',
		        fillOpacity:0.35
		    });
		    tempPoly.setMap(map);
		    return tempPoly;
		}
		function updateInfo(data){
		    data.forEach(function(datamarker){
		        arrayPolygon.push(createPolygon(datamarker.val().bidang.titik));
		    });
		}
		function showErr(err){
		    console.log(err);
		}
		document.getElementById("submit").addEventListener("click",function(){
		    var lines={titik:coords};
		    arrayPolygon.forEach(function(data){
		        data.setMap(null);
		    });
		    markers.forEach(function(data){
		        data.setMap(null);
		    });
	
		dataRef.push(
		            {
		                bidang: lines
		            }
		        );
		        coords=[];
		});
    </script>
</body>
</html>